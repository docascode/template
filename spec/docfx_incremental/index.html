
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="author" content="yufeih" />
<meta name="depot_name" content="." />
<meta name="document_id" content="07688668-0f27-2818-2cfa-5fdc657d3bc2" />
<meta name="document_version_independent_id" content="0f483b5b-1c9a-7396-ec78-b8aa15f0fc07" />
<meta name="gitcommit" content="https://github.com/docascode/template/blob/b800b502012fd6e3c03390528278ff13ccbdfca9/samples/spec/docfx_incremental.md" />
<meta name="locale" content="en-us" />
<meta name="menu_path" content="../../menu.json" />
<meta name="original_content_git_url" content="https://github.com/docascode/template/blob/main/samples/spec/docfx_incremental.md" />
<meta name="rawTitle" content="<h1 id=&quot;doc-as-code-docfxexe-incremental-build-specification&quot;>Doc-as-code: DocFx.exe Incremental Build Specification</h1>" />
<meta name="schema" content="Conceptual" />
<meta name="site_name" content="Docs" />
<meta name="toc_rel" content="../toc.json" />
<meta name="updated_at" content="2021-06-02 06:23 AM" />
<meta name="wordCount" content="420" />


  <title>Doc-as-code: DocFx.exe Incremental Build Specification</title>

  <link rel="stylesheet" href="../../dist/docfx.css">
</head>

<body>
  <header>
<nav class="navbar navbar-expand-md navbar-dark">
  <div class="container-xxl">
    <a class="navbar-brand" href="../../">
        Docfx
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar"></div>
  </div>
</nav>
  </header>

  <main class="container-xxl layout-conceptual page-type-conceptual">
        <nav class="layout-breadcrumb" id="breadcrumb" aria-label="breadcrumb"></nav>

      <nav class="layout-toc">
<div class="sticky-top navbar navbar-expand-md navbar-light bg-white">
  <a class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#toc-pannel" aria-controls="toc-pannel" aria-expanded="false">
    Table of Contents
  </a>
  <div class="collapse navbar-collapse" id="toc-pannel">
    <div>
      <input class="form-control" type="text" id="toc-filter" placeholder="Filter">
      <div class="toc" id="toc"></div>
    </div>
  </div>
</div>
      </nav>

      <article>
        <h1 id="doc-as-code-docfxexe-incremental-build-specification">Doc-as-code: DocFx.exe Incremental Build Specification</h1>
<ul class="metabar">
  <li>
    <time datetime="6/2/2021">6/2/2021</time>
  </li>
  <li class="readingTime">2 minutes to read</li>
    <li class="contributors-holder">
        <ul class="contributors">
              <li>
                <a href="https://github.com/yufeih" title="Yufei Huang">
                  <img src="https://github.com/yufeih.png?size=32" role="presentation"/>
                </a>
              </li>
        </ul>
      </a>
    </li>
</ul>
        <p>This documentation describes the implementation of incrementally extracting metadata from source. Currently we are using <em>Roslyn</em> to compile and analyse source code on the fly. When input sources are large, it may take minutes to load and process the files. To speed up the extraction, previous extracted details are saved to cache for further reference.</p>
<p>There are two level caches in current implementation. First one is called <em>Application</em> Level cache, and the other one is <em>Project</em> level cache.</p>
<p><em>Application</em> level cache is saved in file <code>%LocalAppData%/xdoc/cache</code>.</p>
<p>For <em>Project</em> level cache,</p>
<p>a. If input sources are supported project files, e.g. <code>.csproj</code> or <code>.vbproj</code> files, <em>Project</em> level cache is located in file <code>obj/xdoc/.cache</code> under the same folder of the project file.</p>
<p>b. If input sources are supported source code files, e.g. <code>.cs</code> or <code>.vb</code> files, <em>Project</em> level cache is located in file <code>obj/xdoc/.cache</code> under the same folder of the alphabetically first source code file.</p>
<p>The cache file contains key-value pairs saved in <em>JSON</em> format. The key is the normalized input source code files, and the data structure for the value is as below:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TriggeredUTCTime</td>
<td>The UTC time when the action is triggered</td>
</tr>
<tr>
<td>CompletedUTCTime</td>
<td>The UTC time when the action is completed</td>
</tr>
<tr>
<td>OutputFolder</td>
<td>The output folder for the extracted result</td>
</tr>
<tr>
<td>RelativeOutputFiles</td>
<td>The paths of the extracted results related to the <em>OutputFolder</em></td>
</tr>
<tr>
<td>CheckSum</td>
<td>The MD5 checksum calculated for all the extracted results</td>
</tr>
</tbody>
</table>
<p>Detailed Steps are described below:</p>
<ol>
<li><p>For each input solution/project/source files, get most latest <code>LastModifiedTime</code>.
a. For solution, get <code>LastModifiedTime</code> for the solution file, and containing projects
b. For project, get <code>LastModifiedTime</code> for the project file, project references, assembly references and containing documents.
c. For source files, get <code>LastModifiedTime</code> for the files</p>
</li>
<li><p>Normalize project list, check if <em>Application</em> level cache for these project list exists. Compare <code>TriggeredUTCTime</code> with the <code>LastModifiedTime</code> fetched in #1, and check if checksum remains unchanged for output files. If is, copy result files to output folder. Otherwise, continue to #3.</p>
</li>
<li><p>For each supported solution/project/source code files,</p>
<p><em>Step 1</em>. Check if <em>Project</em> level cache exists. If not, go to <em>Step 4</em>.</p>
<p><em>Step 2</em>. Compare <code>TriggeredUTCTime</code> with the <code>LastModifiedTime</code> fetched in #1, and check if checksum remains unchanged for output files. If not, go to <em>Step 3</em>.</p>
<p><em>Step 3</em>. Generate YAML metadata for current project and save to <em>Project</em> level cache.</p>
</li>
<li><p>Read YAML metadata for each project, and merge with others following rules below:</p>
<p><em>Rule 1</em>. For <code>namespace</code>, if <code>uid</code> equals, <strong>append</strong>.</p>
<p><em>Rule 2</em>. For other type, if <code>uid</code> equals, <strong>override</strong>.</p>
</li>
<li><p>Save result, and update *<em>Application</em> level cache.</p>
</li>
</ol>


        <a class="edit-this-page" href="https://github.com/docascode/template/blob/main/samples/spec/docfx_incremental.md">
          <svg xmlns="http://www.w3.org/2000/svg" height="1em" fill="currentColor" stroke="currentColor" viewBox="0 0 448 448">
            <path d="M426.01 21.914c-29.252-29.216-76.87-29.22-106.127-.008l-.008-.008-283.91 284.744L0 448l141.236-34.39 285.413-289.5C446.33 104.45 448 93.188 448 74.917c0-20.028-7.81-38.856-21.99-53.002zM44.437 402.99l18.206-72.676c26.932 6.47 48.067 27.627 54.44 54.56L44.436 402.99zm40.297-99.93L307.14 80.91l59.81 59.707-222.55 222.28c-10.78-27.27-32.407-48.978-59.667-59.837zm318.163-198.245l-.058-.042-12.72 12.7-59.807-59.71L343.04 45.05l.008.008c16.516-16.463 43.338-16.463 59.79 0 8.002 7.976 12.387 18.573 12.387 29.857 0 11.268-4.385 21.865-12.387 29.84l.058.06z"/>
          </svg>
          Edit this page on GitHub
        </a>
      </article>

      <aside>
        <div class="sticky-top">
          <nav id="in-this-article" class="in-this-article"></nav>
        </div>
      </aside>
  </main>

  <footer>
<div class="container-xxl">
    Â© Microsoft
  <div class="github-star-button">
    <iframe src="https://ghbtns.com/github-btn?user=dotnet&repo=docfx&type=star&count=true" frameborder="0" scrolling="0" width="150" height="20" title="GitHub"></iframe>
  </div>
</div>
  </footer>

  <script type="text/javascript" src="../../dist/docfx.js"></script>
</body>

</html>